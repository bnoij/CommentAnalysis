<!-- @format -->

# 使用指南

## 快速开始

### Windows 用户

双击运行 `start.bat` 脚本,会自动完成以下操作:

1. 检查 Python 环境
2. 创建虚拟环境并安装后端依赖
3. 启动 Flask 后端服务
4. 安装前端依赖并启动开发服务器

### Linux/Mac 用户

```bash
chmod +x start.sh
./start.sh
```

## 手动启动

### 启动后端

1. 进入 backend 目录:

```bash
cd backend
```

2. 创建虚拟环境(首次运行):

```bash
python -m venv venv
```

3. 激活虚拟环境:

Windows:

```bash
venv\Scripts\activate
```

Linux/Mac:

```bash
source venv/bin/activate
```

4. 安装依赖:

```bash
pip install -r requirements.txt
```

5. 运行服务:

```bash
python app.py
```

### 启动前端

1. 返回项目根目录:

```bash
cd ..
```

2. 安装依赖(首次运行):

```bash
npm install
```

3. 启动开发服务器:

```bash
npm run dev
```

## 使用步骤

### 1. 准备数据

准备一个 CSV 文件,包含以下列之一:

-   `comment`: 评论内容
-   `text`: 文本内容
-   `review`: 评论内容

示例:

```csv
comment
这个商品质量很好,非常满意!
物流太慢了,包装也不好
还可以,价格合适
```

### 2. 访问系统

在浏览器中打开: `http://localhost:5173`

### 3. 配置分析参数

#### 选择语言

-   **中文**: 使用 SnowNLP 进行情感分析
-   **英文**: 使用 TextBlob 进行情感分析

#### 选择特征工程方法(可多选)

-   **基础词袋特征**: 词频、字符统计等基础特征
-   **N-gram 特征**: 提取词语的二元组、三元组特征
-   **字符级特征**: 字符级 n-gram 和标点统计
-   **情感词典特征**: 基于预定义词典的情感特征
-   **TF-IDF 特征**: 词频-逆文档频率特征

建议:

-   简单快速分析: 选择"基础词袋特征" + "情感词典特征"
-   深度分析: 全选所有特征

#### 模型集成

-   **关闭**: 使用单一多分类模型
-   **开启**: 使用投票和堆叠集成多个模型

建议: 对于重要分析开启集成以提升准确率

### 4. 上传文件

点击"选择 CSV 文件"按钮,选择准备好的 CSV 文件

### 5. 开始分析

点击"开始分析"按钮,系统会:

1. 上传 CSV 文件到后端
2. 提取文本特征
3. 进行情感分类
4. 计算概率分布
5. 返回分析结果

### 6. 查看结果

#### 统计信息

-   总评论数
-   正面、中性、负面评论的数量和百分比
-   平均情感概率

#### 可视化图表

-   **饼图**: 展示三类情感的分布
-   **柱状图**: 展示平均情感概率

#### 详细结果

-   每条评论的原文
-   情感分类标签
-   三类情感的概率值
-   支持分页浏览

### 7. 导出结果

点击"导出结果"按钮,下载包含所有分析结果的 CSV 文件

## 示例数据

项目提供了两个示例文件可供测试:

### 中文示例

位置: `backend/sample_comments.csv`
包含 15 条中文购物评论

### 英文示例

位置: `backend/sample_comments_en.csv`
包含 15 条英文购物评论

## 特征工程详解

### 1. 基础词袋特征

-   词数统计
-   字符数统计
-   平均词长
-   唯一词数量

### 2. N-gram 特征

-   Bi-gram(二元组): 相邻两个词的组合
-   Tri-gram(三元组): 相邻三个词的组合
-   捕捉词序信息

### 3. 字符级特征

-   字符级 bi-gram 和 tri-gram
-   感叹号、问号数量
-   大写字母比例
-   对表情符号敏感

### 4. 情感词典特征

-   正面词数量
-   负面词数量
-   情感得分
-   情感比例

内置词典包含常用的正负面词汇

### 5. TF-IDF 特征

-   词频(TF): 词在文档中的频率
-   逆文档频率(IDF): 词的重要性
-   高频关键词提取

## 模型集成详解

### 投票集成

使用 3 个不同阈值的模型:

-   严格模型: 阈值(0.7, 0.3)
-   标准模型: 阈值(0.6, 0.4)
-   宽松模型: 阈值(0.55, 0.45)

对三个模型的概率预测取平均值

### 堆叠集成

-   对不同模型赋予权重: [0.4, 0.3, 0.3]
-   基于特征进一步调整概率
-   使用情感词典特征微调结果

## 性能优化建议

### 处理大文件

-   建议单次分析不超过 1000 条评论
-   对于大量数据,可以分批处理
-   CSV 文件大小限制为 16MB

### 提高准确率

1. 选择更多特征工程方法
2. 开启模型集成
3. 确保文本质量(避免过多无关符号)
4. 根据业务场景调整阈值

### 加速分析

1. 减少特征工程方法
2. 关闭模型集成
3. 使用基础特征即可

## 常见问题

### Q1: 后端服务无法启动

**A**: 检查:

-   Python 版本是否>=3.8
-   5000 端口是否被占用
-   依赖是否完整安装

### Q2: 前端无法连接后端

**A**: 确保:

-   后端服务已启动在 5000 端口
-   检查 HomePage.vue 中的 API_BASE_URL 配置
-   关闭防火墙或添加例外

### Q3: 分析结果不准确

**A**: 可以尝试:

-   选择更多特征工程方法
-   开启模型集成
-   检查 CSV 文件编码(使用 UTF-8)
-   清理文本中的特殊字符

### Q4: 中文分词效果不好

**A**: jieba 首次运行会下载词典,请:

-   等待词典下载完成
-   可以自定义用户词典

### Q5: 英文分析失败

**A**: 确保安装了 textblob:

```bash
pip install textblob
```

### Q6: 文件上传失败

**A**: 检查:

-   文件大小是否<16MB
-   文件格式是否为 CSV
-   是否包含必需的列

### Q7: 图表不显示

**A**:

-   检查 echarts 是否安装
-   查看浏览器控制台错误
-   刷新页面重试

## 进阶配置

### 自定义情感词典

编辑 `backend/feature_engineering.py` 中的 `_load_sentiment_dict` 方法,添加领域相关词汇。

### 调整分类阈值

修改 `backend/models.py` 中的 `MultiClassSentiment` 类的阈值参数:

```python
self.positive_threshold = 0.6  # 正面阈值
self.negative_threshold = 0.4  # 负面阈值
```

### 修改集成权重

编辑 `backend/models.py` 中的 `_stacking_ensemble` 方法:

```python
weights = [0.4, 0.3, 0.3]  # 调整权重
```

## 数据隐私

-   所有数据在本地处理
-   不会上传到外部服务器
-   分析完成后临时文件会被删除

## 技术支持

遇到问题可以:

1. 查看本文档的常见问题部分
2. 检查后端和前端的控制台日志
3. 查看项目 README.md 获取更多信息

## 更新日志

### v1.0.0

-   初始版本
-   支持中英文情感分析
-   实现多分类和特征工程
-   添加模型集成
-   完成 Ionic 界面
